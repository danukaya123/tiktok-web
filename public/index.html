<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TikTok Downloader</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 2rem; }
  input { width: 60%; padding: 0.5rem; font-size: 1rem; }
  button { padding: 0.5rem 1rem; font-size: 1rem; margin: 0.5rem; cursor: pointer; }
  img { max-width: 200px; margin-top: 1rem; border-radius: 8px; }
</style>
</head>
<body>
<h1>üì• TikTok Downloader</h1>
<input type="text" id="url" placeholder="Paste TikTok link here" />
<button onclick="fetchTikTokInfo()">Download</button>

<div id="result"></div>

<script>
let tiktokUrl = "";
let tiktokTitle = "";

async function fetchTikTokInfo() {
  tiktokUrl = document.getElementById('url').value.trim();
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = "‚è≥ Fetching...";

  if (!tiktokUrl) {
    resultDiv.innerHTML = "‚ùå Please enter a TikTok URL.";
    return;
  }

  try {
    const res = await fetch(`/api/tiktok-info?url=${encodeURIComponent(tiktokUrl)}`);
    const data = await res.json();

    if (data.error) {
      resultDiv.innerHTML = "‚ùå " + data.error;
      return;
    }

    tiktokTitle = data.title;

    resultDiv.innerHTML = `
      <h2>${data.title}</h2>
      <img src="${data.thumbnail}" alt="Thumbnail" />
      <div>
        <button onclick="downloadMedia('video')">‚¨áÔ∏è Download Video</button>
        <button onclick="downloadMedia('audio')">üéß Download Audio</button>
      </div>
    `;

  } catch (err) {
    console.error(err);
    resultDiv.innerHTML = "‚ùå Failed to fetch video info.";
  }
}

function downloadMedia(type) {
  const url = `/api/tiktok-download?url=${encodeURIComponent(tiktokUrl)}&type=${type}&title=${encodeURIComponent(tiktokTitle)}`;
  window.location.href = url; // triggers browser download
}
</script>
</body>
</html>
